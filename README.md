# okhttp-preloader-interceptor
An [OkHttp interceptor][interceptors] which uses HTTP requests queue with RxJava.

### Prerequisite
```groovy
implementation("com.squareup.okhttp3:okhttp:4.2.x")  
implementation("io.reactivex.rxjava2:rxjava:2.x.x")
```


### Adding interceptor
```java
public static PublishSubject<HTTPPreloaderInterceptor.PreloaderInfo> 
  publishCall = PublishSubject.create();

HTTPPreloaderInterceptor preloaderInterceptor =  new HTTPPreloaderInterceptor(publishCall); 
 
OkHttpClient okHttpClient = builder  
  .addInterceptor(preloaderInterceptor)  
  .build();  
```

### Get queued requests when requests started/stopped
```java
private CompositeDisposable compositeDisposable = new CompositeDisposable();

private void changePreloader(HTTPPreloaderInterceptor.PreloaderInfo info){  
    if(info.isRemained()){  
        // showPreloaderUI()  
    } else {  
        // hidePreloaderUI()
    }  
}

compositeDisposable.add(  
        APIClient.publishCall.subscribe(  
                info -> {  
                    changePreloader(info);  
                }  
        )  
);
```

### Get queued requests when requests started only
```java
compositeDisposable.add(  
	APIClient.publishCall.ofType(HTTPPreloaderInterceptor.PreloaderRequest.class).subscribe(  
	        info -> {  
				  enqueuedRequest(info);
	        }  
	);
);
```

### Get queued requests when requests stopped only
```java
compositeDisposable.add(  
	APIClient.publishCall.ofType(HTTPPreloaderInterceptor.PreloaderResponse.class).subscribe(  
	        info -> {  
				  dequeuedRequest(info);
	        }
	);
);
```

### Destroy
```java
compositeDisposable.dispose();
```


###  Logging
```java
HTTPPreloaderInterceptor preloaderInterceptor =  new HTTPPreloaderInterceptor(publishCallCount);  
preloaderInterceptor.logLevel(HTTPPreloaderInterceptor.LogLevel.REMAINED_REQUESTS_COUNT);  
```

You can change the log level at any time by calling `logLevel()`.

To log to a custom location, pass a `Logger` instance to the constructor.
```java
HttpPreloaderInterceptor logging = new HttpPreloaderInterceptor(new Logger() {
  @Override public void log(String message) {
    Timber.tag("OkHttp").d(message);
  }
});
```

**Warning**: The logs generated by this interceptor when using the `REMAINED_REQUESTS` or `MODIFIED_REQUEST` log levels have the potential to leak sensitive information such as "Authorization" or "Cookie" headers and the contents of request and response bodies. This data should only be logged in a controlled way or in a non-production environment.


[interceptors]: https://square.github.io/okhttp/interceptors/
